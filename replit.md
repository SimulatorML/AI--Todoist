# Обзор

Telegram-бот, который создает задачи в Todoist через API Todoist. Построен на Python с использованием async/await для оптимальной производительности. Бот позволяет пользователям преобразовывать любое текстовое сообщение в задачу Todoist после настройки личного API токена Todoist. Включает поддержку нескольких пользователей, защиту от дублирования с использованием ID сообщений Telegram и всестороннюю обработку ошибок.

**Статус**: Полностью реализован и протестирован. Все компоненты работают корректно. Боту требуется переменная окружения TELEGRAM_BOT_TOKEN для запуска.

# Пользовательские Предпочтения

Предпочитаемый стиль общения: Простой, повседневный язык.

# Системная Архитектура

## Frontend Архитектура
- **Интерфейс Telegram Бота**: Использует `AsyncTeleBot` из pyTelegramBotAPI для асинхронной обработки сообщений
- **Система Команд**: Реализует слеш-команды (`/start`, `/token`, `/help`) для конфигурации бота и руководства пользователей
- **Обработка Сообщений**: Каждое не-командное текстовое сообщение автоматически преобразуется в задачу Todoist

## Backend Архитектура
- **Паттерн Async/Await**: Полностью построен с async/await для высокопроизводительных параллельных операций
- **Модульный Дизайн**: Разделен на отдельные модули:
  - `main.py`: Инициализация бота и обработчики сообщений
  - `todoist_client.py`: Асинхронный клиент Todoist API с использованием httpx
  - `database.py`: Хранилище токенов пользователей в памяти
  - `models.py`: Модели Pydantic для валидации данных
- **Обработка Ошибок**: Всесторонняя обработка ошибок с логированием и понятными для пользователя сообщениями об ошибках
- **Идемпотентность**: Использует ID сообщений Telegram как ID запросов для предотвращения дублирования задач

## Решения для Хранения Данных
- **Хранилище в Памяти**: Простое хранилище на основе словаря в памяти для токенов Todoist пользователей
- **Класс UserTokenStorage**: Управляет CRUD операциями для токенов аутентификации пользователей
- **Отсутствие Постоянной Базы Данных**: Текущая реализация использует временное хранилище в памяти (токены теряются при перезапуске)

## Аутентификация и Авторизация
- **Токен Telegram Бота**: Аутентификация бота на основе переменных окружения
- **Пользовательские Токены Todoist**: Хранилище API токенов Todoist для каждого пользователя для персонализированного создания задач
- **Управление Токенами**: Пользователи устанавливают свои собственные API токены Todoist через команду `/token`
- **Безопасность**: Чувствительные токены хранятся как переменные окружения и только в памяти

## Дизайн API
- **RESTful Интеграция**: Использует Todoist REST API v2 для создания задач
- **HTTP Клиент**: httpx для асинхронных HTTP операций
- **Модели Запроса/Ответа**: Модели Pydantic обеспечивают безопасность типов и валидацию
- **Ограничение Скорости**: Полагается на встроенное ограничение скорости Todoist API

# Внешние Зависимости

## Сторонние Сервисы
- **Telegram Bot API**: Основная интеграция платформы обмена сообщениями
- **Todoist REST API v2**: Сервис управления задачами для создания и управления задачами

## Python Библиотеки
- **pyTelegramBotAPI**: Асинхронный фреймворк Telegram бота
- **httpx**: Современный асинхронный HTTP клиент для API запросов  
- **pydantic**: Валидация и парсинг данных с использованием подсказок типов Python
- **python-dotenv**: Управление переменными окружения
- **aiohttp**: Дополнительная поддержка асинхронного HTTP

## Зависимости для Разработки
- **pytest**: Фреймворк тестирования
- **pytest-asyncio**: Поддержка асинхронного тестирования

## API Эндпоинты
- **Todoist API**: `https://api.todoist.com/rest/v2/tasks` для создания задач
- **Telegram Bot API**: Получение сообщений на основе webhook или polling

## Требования к Конфигурации
- **TELEGRAM_BOT_TOKEN**: Обязательная переменная окружения для аутентификации бота
- **Пользовательские Токены Todoist**: Индивидуальные пользовательские API токены, собираемые через команды бота